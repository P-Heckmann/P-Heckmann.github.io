<!DOCTYPE html>
<html>

<head>
    <title>Paul Heckmann</title>
    <link rel="stylesheet" href="../../css/styles.css">
    <link rel="stylesheet" href="../../css/prism.css" />
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <script src="../../scripts/prism.js"></script>
</head>

<body>
    <header>
        <h1>Paul Heckmann - Data scientist</h1>
    </header>
    <nav class="navbar">
        <div class="collapse navbar-collapse" id="collapsibleNavbar">
            <li class="nav-item"><a class="nav-link" href="../../index.html">Home</a></li>
            <li class="nav-item"><a class="nav-link" href="../Data_science.html">Projects</a></li>
            <li class="nav-item"><a class="nav-link" href="../About.html">About</a></li>
            </ul>
        </div>
    </nav>
    <main>
        <section>
            <h1>
                Historical weather data analysis
            </h1><br>
            <h2>
                <a style="text-decoration:none"
                    href="https://p-heckmann-weather-home-deploy-pwgt2l.streamlit.app/">Click here to go to the app</a>
            </h2>
            <hr />
            <p>The raw data for this project are 36 semicolon separated text files containing the temperature,
                precipitation and sunshine duration for each month of the years 1881 to 2022. In a first step, the
                individual text files were merged into one file for each metric (temperature,
                precipitation and sunshine duration) with the following function:
            </p>
            <pre>
                    <code class="language-python">
    def merge_textfiles(directory_path, name="merged.txt"):
    """
    Merges multiple text files into one and saves the merged content.

    Args:
        directory_path (str): The path to the directory containing the text files.
        name (str, optional): The name of the merged file to be saved. Defaults to 'merged.txt'.
    """
    # Create an empty string to store the merged data
    merged_data = ""

    # Loop through all files in the directory
    for i, filename in enumerate(os.listdir(directory_path)):
        if filename.endswith(".txt"):
            # Open the text file and read its contents
            with open(os.path.join(directory_path, filename), "r") as file:
                # Skip the first line (header) for all files except the first one
                if i > 0:
                    file_contents = file.readlines()[1:]
                else:
                    file_contents = file.readlines()

            # Add the contents to the merged_data string with a semicolon separator
            merged_data += "".join(file_contents).strip() + ";"

    # Save the merged data to a file
    with open(os.path.join(directory_path, name), "w") as file:
        file.write(merged_data)
                    </code>
                 </pre>
            <p>
                In a next step, the data is reduced to a yearly average for each metric, transformed into a long format
                and saved as a pickle file:
            </p>
            <pre>
                    <code class="language-python">
    def yearlyAverageDataframe(directory_path, name="pickled"):
    """
    Loads a dataset from the specified directory 
    path and performs operations to calculate the yearly average 
    metric for each state. The resulting dataframe is transformed
    from wide to long format and saved as a pickle file.

    Args:
        directory_path (str): The path to the directory containing the air temperature dataset.
        name (str, optional): The name of the pickle file to be saved. Defaults to "pickled".

    Returns:
        str: The path to the saved pickle file.

    Raises:
        This function does not raise any specific exceptions. It relies on the pandas library to handle any file reading errors encountered.

    Example:
        directory = 'data/temperature/'
        result = yearlyAverageDataframe(directory, name="air_temp_mean")
        print(result)
    """
    # load air temperature dataset
    df = pd.read_csv(directory_path, sep=";", skiprows=[0], on_bad_lines="skip")

    # create new column with timestamp from the columns year and month
    df["date"] = pd.to_datetime(
        df["Jahr"].astype(str) + "-" + df["Monat"].astype(str) + "-1"
    )

    # list of columns to drop
    drop_cols = [
        "^Unnamed",
        "Jahr",
        "Monat",
        "^Deutschland",
        "Thueringen/Sachsen-Anhalt",
        "Brandenburg/Berlin",
        "Niedersachsen/Hamburg/Bremen",
    ]

    # drop unwanted columns
    df = df.loc[:, ~df.columns.str.contains("|".join(drop_cols))]

    # Sort the dataframe by date
    df_sorted = df.sort_values(by="date")

    # get list of all states except date
    columns = df.drop("date", axis=1).columns.tolist()

    # groupby yearly average
    yearly_average = (
        df.groupby(df["date"].dt.year)[columns].mean().reset_index(drop=False)
    )

    # transform the data from wide to long format
    data = yearly_average.melt("date", var_name="Bundesland", value_name="value")

    # save dataframe to pickle
    processed_df = data.to_pickle(rf"data\pickle\{name}.pkl")

    return processed_df
                    </code>
                 </pre>
            <p>
                Next the functions are called in a simple for loop to process the raw data:
            </p>
            <pre>
                    <code class="language-python">
    directory_path_txt_1 = r".\.\data\air_temp_mean"
    directory_path_txt_2 = r".\.\data\precipitation_mean"
    directory_path_txt_3 = r".\.\data\sunshine_duration"

    name_1 = "merged_air_temp_mean.txt"
    name_2 = "merged_precipitation_mean.txt"
    name_3 = "merged_sunshine_duration.txt"

    path_list = [directory_path_txt_1,directory_path_txt_2,directory_path_txt_3]

    name_list = [name_1,name_2,name_3]

    for path, name in zip(path_list, name_list):
        func.merge_textfiles(path, name)

    directory_path_1 = r".\.\data\merged\merged_air_temp_mean.txt"
    directory_path_2 = r".\.\data\merged\merged_precipitation_mean.txt"
    directory_path_3 = r".\.\data\merged\merged_sunshine_duration.txt"

    path_list_2 = [directory_path_1,directory_path_2,directory_path_3]

    name_1 = "air_temp_mean"
    name_2 = "precipitation_mean"
    name_3 = "sunshine_duration"

    name_list_2 = [name_1,name_2,name_3]
                        
    for path,name in zip(path_list_2,name_list_2):
        func.yearlyAverageDataframe(path, name)
                    </code>
                 </pre>
        </section>
    </main>
    <footer>
        <p>Copyright &copy; Paul Heckmann 2023.
    </footer>
</body>

</html>